Run appleboy/ssh-action@master
  with:
    host: ***
    username: ***
    key: ***
    script: # Переход в директорию проекта
  cd $DEPLOY_PATH

  # Установка зависимостей системы (если нужно)
  sudo apt update
  sudo apt install -y python3-venv

  # Удаление старых файлов (по желанию)
  rm -rf app production.py requirements.txt .env

  # Копирование новых файлов из репозитория
  scp -r user@yourdomain.com:/path/to/local/project/* .

  # Проверка наличия requirements.txt
  if [ ! -f "requirements.txt" ]; then
    echo "Файл requirements.txt отсутствует!"
    exit 1
  fi

  # Создание виртуального окружения
  python3 -m venv venv
  source venv/bin/activate

  # Установка зависимостей
  pip install -r requirements.txt --ignore-installed

  # Перезапуск Uvicorn
  pkill -f uvicorn || true
  nohup uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload &
    port: 22
    protocol: tcp
    timeout: 30s
    command_timeout: 10m
    proxy_port: 22
    proxy_protocol: tcp
    proxy_timeout: 30s
    curl_insecure: false
    capture_stdout: false
Run echo "$GITHUB_ACTION_PATH" >> $GITHUB_PATH
  echo "$GITHUB_ACTION_PATH" >> $GITHUB_PATH
  shell: /usr/bin/bash --noprofile --norc -e -o pipefail {0}
  env:
    GITHUB_ACTION_PATH: /home/runner/work/_actions/appleboy/ssh-action/master
Run entrypoint.sh
  entrypoint.sh
  shell: /usr/bin/bash --noprofile --norc -e -o pipefail {0}
  env:
    GITHUB_ACTION_PATH: /home/runner/work/_actions/appleboy/ssh-action/master
    INPUT_HOST: ***
    INPUT_PORT: 22
    INPUT_PROTOCOL: tcp
    INPUT_USERNAME: ***
    INPUT_PASSWORD:
    INPUT_PASSPHRASE:
    INPUT_KEY: ***
    INPUT_KEY_PATH:
    INPUT_FINGERPRINT:
    INPUT_PROXY_HOST:
    INPUT_PROXY_PORT: 22
    INPUT_PROXY_USERNAME:
    INPUT_PROXY_PASSWORD:
    INPUT_PROXY_PASSPHRASE:
    INPUT_PROXY_KEY:
    INPUT_PROXY_KEY_PATH:
    INPUT_PROXY_FINGERPRINT:
    INPUT_TIMEOUT: 30s
    INPUT_PROXY_TIMEOUT: 30s
    INPUT_COMMAND_TIMEOUT: 10m
    INPUT_SCRIPT: # Переход в директорию проекта
  cd $DEPLOY_PATH

  # Установка зависимостей системы (если нужно)
  sudo apt update
  sudo apt install -y python3-venv

  # Удаление старых файлов (по желанию)
  rm -rf app production.py requirements.txt .env

  # Копирование новых файлов из репозитория
  scp -r user@yourdomain.com:/path/to/local/project/* .

  # Проверка наличия requirements.txt
  if [ ! -f "requirements.txt" ]; then
    echo "Файл requirements.txt отсутствует!"
    exit 1
  fi

  # Создание виртуального окружения
  python3 -m venv venv
  source venv/bin/activate

  # Установка зависимостей
  pip install -r requirements.txt --ignore-installed

  # Перезапуск Uvicorn
  pkill -f uvicorn || true
  nohup uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload &
    INPUT_SCRIPT_FILE:
    INPUT_ENVS:
    INPUT_ENVS_FORMAT:
    INPUT_DEBUG:
    INPUT_ALL_ENVS:
    INPUT_REQUEST_PTY:
    INPUT_USE_INSECURE_CIPHER:
    INPUT_CIPHER:
    INPUT_PROXY_USE_INSECURE_CIPHER:
    INPUT_PROXY_CIPHER:
    INPUT_SYNC:
    INPUT_CAPTURE_STDOUT: false
    INPUT_CURL_INSECURE: false
    DRONE_SSH_VERSION:
Downloading drone-ssh-1.8.1-linux-amd64 from https://github.com/appleboy/drone-ssh/releases/download/v1.8.1
======= CLI Version Information =======
Drone SSH version 1.8.1
=======================================
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
ssh: connect to host yourdomain.com port 22: Connection refused
Файл requirements.txt отсутствует!
2025/09/19 22:43:27 Process exited with status 1
Error: Process completed with exit code 1.